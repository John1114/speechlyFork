<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset='utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=1'>

	<title>Svelte app</title>

  <link rel='icon' type='image/png' href='favicon.png'>
	<link rel='stylesheet' href='global.css'>
  <link rel="stylesheet" href="speechly-ui.css">
  
	<script defer src='dev/push-to-talk-button.js'></script>
	<script defer src='dev/big-transcript.js'></script>
</head>

<body>
  <div class="BigTranscriptContainer">
    <big-transcript></big-transcript>
  </div>

    <h1>&lt;push-to-talk-button/&gt;</h1>
	  Autonomous customElement for connecting to Speechly and controlling listening on/off.
    <h3>Attributes</h3>
    <ul>
      <li>appid - Speechly App id to connect to.
      <li>capturekey - Optional string (of length 1). Defines a keyboard hotkey that with control listening on/off. Default: undefined. Recommendation: Space (" ")</li>
      <li>size - Optional string (css). Defines the button frame width and height. Default: "6rem"</li>
      <li>icon - Optional string. Defines the initial icon on button: idle | ready | noaudioconsent | failed | nobrowsersupport </li>
    </ul>
    <h3>Properties</h3>
    <ul>
      <li>onholdstart - set callback function to be triggered upon hold start</li>
      <li>onholdend - set callback function to be triggered upon hold end</li>
    </ul>
    <h3>Events</h3>
    <ul>
      <li>onholdstart - CustomEvent triggered upon hold start</li>
      <li>onholdend - CustomEvent triggered upon hold end</li>
	    <li>segment-update - CustomEvent triggered when speech-to-text segment changes. Segment available as the event.details property.</li>
      <li>error - Details: Failed | NoBrowserSupport | NoAudioConsent</li>
    </ul>

    <h1>&lt;big-transcript/&gt;</h1>
	  Autonomous customElement for connecting to Speechly and controlling listening on/off.
    <h3>Properties</h3>
    <ul>
      <li>onsegmentupdate(segment) - Call whenever a new segment update is available</li>
    </ul>

    <pre id="info" style="padding-bottom: 10rem;"></pre>

    <div class="PushToTalkContainer">
  		<push-to-talk-button appid="60cf344c-c010-48d7-bc53-9c72b1f65505"></push-to-talk-button>
	  </div>

	<script>
    var webLogLines = "";
    webLog = (newLine) => {
      webLogLines += newLine + "\n";
      document.getElementById("info").innerHTML = webLogLines;
    }
    webLog("Starting index.html script...");
		const pushToTalkEl = document.getElementsByTagName("push-to-talk-button")[0];
    webLog("pushToTalkEl: "+pushToTalkEl);
		const transcriptEl = document.getElementsByTagName("big-transcript")[0];
    webLog("transcriptEl: "+transcriptEl);
    webLog("transcriptEl.onSegmentUpdate: "+transcriptEl.onSegmentUpdate);


    pushToTalkEl.onholdstart = () => {console.log("onholdstart property triggered")};
		pushToTalkEl.onholdend = () => {console.log("onholdend property triggered")};
		pushToTalkEl.addEventListener("onholdstart", (e) => {console.log("onholdstart message received")});
		pushToTalkEl.addEventListener("onholdend", (e) => {console.log("onholdend message received")});
		pushToTalkEl.addEventListener("segment-update", (e) => {
      console.log("segment-update message received:", e.detail)
      webLog(e.detail.words.map(w => w.value).join(" "))
      // transcriptEl.onSegmentUpdate(e.detail);
      transcriptEl.dispatchEvent(new CustomEvent("segment-update", {detail: e.detail}));
    });
		pushToTalkEl.addEventListener("error", (e) => {
      webLog(`error message received: ${e.detail}`)
      console.log(`error message received: ${e.detail}`)
    });
		transcriptEl.addEventListener("debug", (e) => {
      webLog(`${e.detail}`)
    });
    webLog("Finished index.html script.");

    i = window.setInterval(() => {
      console.log("interval");
      const d = {
          "id": 0,
          "contextId": "9d1b252e-7606-4b1b-87d7-6645661ea385",
          "isFinal": false,
          "words": [
              {
                  "value": "TWO",
                  "index": 2,
                  "startTimestamp": 840,
                  "endTimestamp": 1440,
                  "isFinal": true
              }
          ],
          "entities": [
              {
                  "type": "email",
                  "value": "2",
                  "startPosition": 2,
                  "endPosition": 3,
                  "isFinal": true
              }
          ],
          "intent": {
              "intent": "email",
              "isFinal": false
          }
      }
      // transcriptEl.onSegmentUpdate(d);
      transcriptEl.dispatchEvent(new CustomEvent("segment-update", {detail: d}));
    }, 3000);
	</script>
</body>
</html>
